<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, push, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDM6DpRSeZueVKRpbyJyDmhf8WY66KyCDk",
  authDomain: "dailyquiz-d5279.firebaseapp.com",
  databaseURL: "https://dailyquiz-d5279-default-rtdb.firebaseio.com",
  projectId: "dailyquiz-d5279",
  storageBucket: "dailyquiz-d5279.firebasestorage.app",
  messagingSenderId: "94577748034",
  appId: "1:94577748034:web:c032d3a1d72db1313de5db",
  measurementId: "G-19DVN7NNH7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

document.getElementById("btnSave").onclick = async () => {
  const title = document.getElementById("title").value || "Untitled";
  const lat = parseFloat(document.getElementById("lat").value);
  const lng = parseFloat(document.getElementById("lng").value);
  const radius = parseInt(document.getElementById("radius").value, 10) || 40;
  const file = document.getElementById("file").files[0];

  if (!file || isNaN(lat) || isNaN(lng)) {
    alert("Missing required data");
    return;
  }

  // Upload image
  const path = `photos/${Date.now()}_${file.name.replace(/\s+/g,'_')}`;
  const imgRef = sRef(storage, path);
  await uploadBytes(imgRef, file);
  const url = await getDownloadURL(imgRef);

  // Save to RTDB
  const spotsRef = ref(db, "spots");
  const newSpotRef = push(spotsRef);
  await set(newSpotRef, {
    title, lat, lng, radiusMeters: radius,
    imageURL: url, active: true, createdAt: Date.now()
  });

  alert("Saved!");
};
</script>
