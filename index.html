<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pediatric Drug Dose Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f8ff;
      padding: 20px;
    }
    h2 {
      color: #004d99;
    }
    label, select, input {
      display: block;
      margin: 10px 0;
    }
    .result, .details {
      margin-top: 20px;
      background: #e6f2ff;
      padding: 10px;
      border-left: 4px solid #004d99;
    }
    .notes {
      margin-top: 30px;
      padding: 15px;
      background: #fff8dc;
      border-left: 4px solid #ff9900;
    }
  </style>
</head>
<body>

  <h2>Pediatric Drug Dose Calculator (Denver Metro EMS Protocol)</h2>

  <label for="inputType">Enter Weight or Age:</label>
  <select id="inputType" onchange="toggleInputType()">
    <option value="weight">Enter Weight (kg)</option>
    <option value="age">Estimate Weight by Age</option>
  </select>

  <input type="number" id="weightInput" placeholder="Weight in kg">
  <input type="number" id="ageInput" placeholder="Age in years" style="display:none">

  <label for="complaint">Select Chief Complaint:</label>
  <select id="complaint" onchange="filterDrugs()">
    <option value="all">All</option>
    <option value="anaphylaxis">Anaphylaxis</option>
    <option value="seizure">Seizure</option>
    <option value="nausea">Nausea</option>
    <option value="pain">Pain</option>
    <option value="respiratory">Respiratory Distress</option>
    <option value="cardiac">Cardiac Arrest</option>
    <option value="hypoglycemia">Hypoglycemia</option>
  </select>

  <label for="medication">Select Medication:</label>
  <select id="medication"></select>

  <label for="concentration">Medication Concentration (mg/mL):</label>
  <input type="number" id="concentration" placeholder="e.g., 1 for 1:1,000 or 5 for Midazolam 5mg/mL">

  <button onclick="calculateDose()">Calculate Dose</button>

  <div class="details" id="drugDetails"></div>
  <div class="result" id="output"></div>

  <div class="notes">
    <h4>Protocol Reference:</h4>
    <p>This calculator follows the <strong>Denver Metro EMS Pediatric Drug Protocols (2024)</strong>.</p>
    <h4>Dose Equation:</h4>
    <p><strong>mg dose = weight (kg) ร dose per kg</strong><br>
       <strong>mL to administer = mg dose รท concentration (mg/mL)</strong><br>
       If dose exceeds protocol max, the max is used.</p>
  </div>

  <script>
    const protocolDoses = {
      'epi_im_anaphylaxis': {
        dosePerKg: 0.01, maxDose: 0.3,
        indication: "Anaphylaxis, severe allergic reaction, upper airway stridor (croup).",
        contraindication: "None in life-threatening anaphylaxis.",
        route: "IM (Intramuscular)",
        complaint: "anaphylaxis"
      },
      'midazolam_in_seizure': {
        dosePerKg: 0.2, maxDose: 10,
        indication: "Active seizures, status epilepticus.",
        contraindication: "Hypotension, respiratory depression, allergy to benzodiazepines.",
        route: "IN (Intranasal), also IV/IM if available",
        complaint: "seizure"
      },
      'ondansetron_iv_nausea': {
        dosePerKg: 0.1, maxDose: 4,
        indication: "Nausea, vomiting.",
        contraindication: "Prolonged QT interval, hypersensitivity.",
        route: "IV, IM, PO, or ODT",
        complaint: "nausea"
      }
    };

    function toggleInputType() {
      const inputType = document.getElementById('inputType').value;
      document.getElementById('weightInput').style.display = inputType === 'weight' ? 'block' : 'none';
      document.getElementById('ageInput').style.display = inputType === 'age' ? 'block' : 'none';
    }

    function getWeight() {
      const type = document.getElementById('inputType').value;
      if (type === 'weight') return parseFloat(document.getElementById('weightInput').value);
      const age = parseFloat(document.getElementById('ageInput').value);
      return isNaN(age) ? NaN : (age * 2 + 8);
    }

    function filterDrugs() {
      const complaint = document.getElementById('complaint').value;
      const medSelect = document.getElementById('medication');
      medSelect.innerHTML = '';
      for (const key in protocolDoses) {
        if (complaint === 'all' || protocolDoses[key].complaint === complaint) {
          const option = document.createElement('option');
          option.value = key;
          option.text = key.replace(/_/g, ' ').toUpperCase();
          medSelect.appendChild(option);
        }
      }
      updateDrugDetails();
    }

    function updateDrugDetails() {
      const medKey = document.getElementById('medication').value;
      const details = protocolDoses[medKey];
      const drugDetails = document.getElementById('drugDetails');
      if (!details) return;
      drugDetails.innerHTML = `
        <strong>Indication:</strong> ${details.indication}<br>
        <strong>Contraindication:</strong> ${details.contraindication}<br>
        <strong>Route:</strong> ${details.route}
      `;
    }

    function calculateDose() {
      const weight = getWeight();
      const medKey = document.getElementById('medication').value;
      const concentration = parseFloat(document.getElementById('concentration').value);
      const output = document.getElementById('output');

      if (isNaN(weight) || isNaN(concentration)) {
        output.innerHTML = "<strong>Please enter valid weight/age and concentration.</strong>";
        return;
      }

      const { dosePerKg, maxDose } = protocolDoses[medKey];
      let doseMg = weight * dosePerKg;
      let isMaxed = false;

      if (doseMg > maxDose) {
        doseMg = maxDose;
        isMaxed = true;
      }

      const volumeMl = doseMg / concentration;

      output.innerHTML = `
        <strong>Calculated Dose:</strong><br>
        Weight: ${weight.toFixed(1)} kg<br>
        Medication Dose: ${doseMg.toFixed(2)} mg<br>
        Volume to Administer: ${volumeMl.toFixed(2)} mL<br>
        ${isMaxed ? "<em>Max dose applied per protocol.</em>" : ""}
      `;
    }

    window.onload = filterDrugs;
  </script>

</body>
</html>
