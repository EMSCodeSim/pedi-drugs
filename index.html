<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pediatric Drug Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background: #eef9ff; padding: 20px; font-size: 1.1em; }
    label, select, input, button {
      width: 100%; margin: 10px 0; padding: 10px; font-size: 1em;
    }
    .age-inputs { display: flex; gap: 10px; }
    .section { background: #d9f0ff; padding: 15px; margin-top: 15px; border-left: 4px solid #0077cc; }
    .medication { background: #fff; margin-top: 10px; padding: 10px; border: 1px solid #ccc; }
    .medication h4 { margin: 0 0 5px 0; }
    .warning { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h2>Pediatric Drug Lookup (Denver Metro EMS)</h2>

<label>Chief Complaint</label>
<select id="complaintSelect" onchange="loadMedications()">
  <option value="">-- Select --</option>
</select>

<label>Patient Age</label>
<div class="age-inputs">
  <input type="number" id="ageYears" placeholder="Years" min="0">
  <input type="number" id="ageMonths" placeholder="Months" min="0" max="11">
  <input type="number" id="ageDays" placeholder="Days" min="0" max="30">
</div>

<button onclick="loadMedications()">Find Medications</button>

<div id="medList" class="section"></div>

<script>
let allMeds = {};

fetch("medications_by_complaint_with_age_first.json")
  .then(res => res.json())
  .then(data => {
    allMeds = data;
    const complaintSelect = document.getElementById("complaintSelect");
    Object.keys(data).forEach(complaint => {
      const option = document.createElement("option");
      option.value = complaint;
      option.textContent = complaint;
      complaintSelect.appendChild(option);
    });
  });

function getAgeInText() {
  const y = parseInt(document.getElementById("ageYears").value) || 0;
  const m = parseInt(document.getElementById("ageMonths").value) || 0;
  const d = parseInt(document.getElementById("ageDays").value) || 0;
  return `${y}y ${m}m ${d}d`;
}

function loadMedications() {
  const complaint = document.getElementById("complaintSelect").value;
  const ageY = parseInt(document.getElementById("ageYears").value) || 0;
  const medList = document.getElementById("medList");
  medList.innerHTML = "";

  if (!complaint || !allMeds[complaint]) {
    medList.innerHTML = "<div class='warning'>Please select a chief complaint and enter age.</div>";
    return;
  }

  const matches = allMeds[complaint].filter(med => {
    const range = med.age_range.toLowerCase();
    return (
      range.includes("all") ||
      (range.includes("adult") && ageY >= 18) ||
      (range.includes("pediatric") && ageY < 18) ||
      (range.includes("<") && ageY < parseInt(range.match(/\d+/))) ||
      (range.includes(">") && ageY > parseInt(range.match(/\d+/))) ||
      (range.includes("-") && ageY >= parseInt(range.split("-")[0]) && ageY <= parseInt(range.split("-")[1]))
    );
  });

  if (matches.length === 0) {
    medList.innerHTML = "<div class='warning'>No medications found for this age and complaint.</div>";
    return;
  }

  matches.forEach(med => {
    const div = document.createElement("div");
    div.className = "medication";
    div.innerHTML = `
      <h4>${med.medication} (${med.route})</h4>
      <strong>Age Range:</strong> ${med.age_range}<br>
      <strong>Indication:</strong> ${med.indication}<br>
      <strong>Dose:</strong> ${med.dose}<br>
      <strong>Concentration:</strong> ${med.concentration}<br>
      <strong>Max Dose:</strong> ${med.max_dose}<br>
      <strong>Max Doses:</strong> ${med.max_doses}<br>
      <strong>Call-In:</strong> ${med.call_in}<br>
      <strong>Contraindication:</strong> ${med.contraindication}<br>
      ${med.drip_setup !== "N/A" ? `<strong>Drip Setup:</strong> ${med.drip_setup}` : ""}
    `;
    medList.appendChild(div);
  });
}
</script>

</body>
</html>
