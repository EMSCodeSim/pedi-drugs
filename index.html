<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pediatric Drug Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; padding: 20px; font-size: 1.1em; }
    h2 { color: #004d99; }
    label, select, input, button {
      width: 100%; margin: 10px 0; padding: 12px; font-size: 1em;
    }
    .section, .result, .notes {
      background: #e6f2ff;
      padding: 15px;
      margin-top: 15px;
      border-left: 4px solid #004d99;
    }
    .notes {
      background: #fff8dc;
      border-left: 4px solid #ff9900;
    }
    .warning, .disclaimer {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>Pediatric Drug Calculator (Denver Metro EMS)</h2>

<label>Chief Complaint</label>
<select id="complaint" onchange="loadDrugs()">
  <option value="">-- Select --</option>
  <option value="seizure">Seizure</option>
  <option value="pain">Pain</option>
</select>

<div id="drugSection" class="section" style="display:none;">
  <label>Medication</label>
  <select id="drug" onchange="loadRoutes()"></select>

  <label>Route</label>
  <select id="route" onchange="updateInfo()"></select>

  <div id="drugInfo" class="notes"></div>

  <label>Age (years)</label>
  <input type="number" id="age" placeholder="Enter patient age">

  <label>Broselow Tape Color (optional)</label>
  <select id="broselowColor" onchange="estimateWeightByColor()">
    <option value="">-- Select Color --</option>
    <option value="gray">Gray (~3 kg)</option>
    <option value="pink">Pink (~5 kg)</option>
    <option value="red">Red (~8 kg)</option>
    <option value="purple">Purple (~10 kg)</option>
    <option value="yellow">Yellow (~14 kg)</option>
    <option value="white">White (~18 kg)</option>
    <option value="blue">Blue (~22 kg)</option>
    <option value="orange">Orange (~28 kg)</option>
    <option value="green">Green (~34 kg)</option>
  </select>

  <label>Weight (kg)</label>
  <input type="number" id="weight" placeholder="Enter weight or use tape color">

  <label>Concentration (mg/mL)</label>
  <input type="number" id="concentration" placeholder="e.g., 1 or 5">

  <button onclick="calculateDose()">Calculate Dose</button>
  <div id="warning" class="warning"></div>
</div>

<div id="result" class="result" style="display:none;"></div>
<div class="disclaimer" id="disclaimer" style="display:none;">
  ‚ö†Ô∏è Confirm all calculations and doses before administration.
</div>
<button id="homeButton" onclick="location.reload()" style="display:none;">üîÅ Start Over</button>

<div class="notes">
  <strong>Reference:</strong> Denver Metro EMS Protocols (2025)<br>
  Dose = weight (kg) √ó dose/kg ¬∑ Volume = mg √∑ concentration
</div>

<script>
  const drugs = {
    seizure: {
      midazolam: {
        name: "Midazolam",
        routes: {
          IV: { dosePerKg: 0.1, maxDose: 5 },
          IN: { dosePerKg: 0.2, maxDose: 10 }
        },
        indication: "Active seizure",
        contraindication: "Respiratory depression",
        minAge: 0, maxAge: 18,
        callIn: false
      }
    },
    pain: {
      fentanyl: {
        name: "Fentanyl",
        routes: {
          IV: { dosePerKg: 1, maxDose: 100 },
          IN: { dosePerKg: 2, maxDose: 200 }
        },
        indication: "Moderate to severe pain",
        contraindication: "Respiratory depression",
        minAge: 0, maxAge: 18,
        callIn: false
      }
    }
  };

  function loadDrugs() {
    const complaint = document.getElementById('complaint').value;
    const drugSelect = document.getElementById('drug');
    drugSelect.innerHTML = '';
    if (!drugs[complaint]) return;

    Object.keys(drugs[complaint]).forEach(key => {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = drugs[complaint][key].name;
      drugSelect.appendChild(opt);
    });

    document.getElementById('drugSection').style.display = 'block';
    loadRoutes();
  }

  function loadRoutes() {
    const complaint = document.getElementById('complaint').value;
    const drug = document.getElementById('drug').value;
    const routeSelect = document.getElementById('route');
    routeSelect.innerHTML = '';
    if (!drugs[complaint] || !drugs[complaint][drug]) return;

    Object.keys(drugs[complaint][drug].routes).forEach(rt => {
      const opt = document.createElement('option');
      opt.value = rt;
      opt.textContent = rt;
      routeSelect.appendChild(opt);
    });

    updateInfo();
  }

  function updateInfo() {
    const complaint = document.getElementById('complaint').value;
    const drug = document.getElementById('drug').value;
    const info = drugs[complaint][drug];
    document.getElementById('drugInfo').innerHTML =
      `<strong>Indication:</strong> ${info.indication}<br>
       <strong>Contraindication:</strong> ${info.contraindication}<br>
       ${info.callIn ? "<strong style='color:red;'>Call-in required</strong>" : ""}`;
  }

  function estimateWeightByColor() {
    const map = {
      gray: 3, pink: 5, red: 8, purple: 10,
      yellow: 14, white: 18, blue: 22, orange: 28, green: 34
    };
    const color = document.getElementById('broselowColor').value;
    if (map[color]) {
      document.getElementById('weight').value = map[color];
    }
  }

  function calculateDose() {
    const complaint = document.getElementById('complaint').value;
    const drugKey = document.getElementById('drug').value;
    const route = document.getElementById('route').value;
    const age = parseFloat(document.getElementById('age').value);
    let weight = parseFloat(document.getElementById('weight').value);
    const conc = parseFloat(document.getElementById('concentration').value);
    const warningDiv = document.getElementById('warning');
    const resultDiv = document.getElementById('result');
    const disclaimer = document.getElementById('disclaimer');
    const homeBtn = document.getElementById('homeButton');

    warningDiv.innerHTML = '';
    resultDiv.style.display = 'none';
    disclaimer.style.display = 'none';
    homeBtn.style.display = 'none';

    if (!age || isNaN(age)) {
      warningDiv.textContent = "Age is required.";
      return;
    }

    if (!weight || isNaN(weight)) {
      weight = (age * 2) + 8;
    }

    if (!conc || isNaN(conc)) {
      warningDiv.textContent = "Enter valid concentration.";
      return;
    }

    const drug = drugs[complaint][drugKey];
    if (age < drug.minAge || age > drug.maxAge) {
      warningDiv.textContent = `Age outside protocol range (${drug.minAge}-${drug.maxAge} years).`;
      return;
    }

    const doseData = drug.routes[route];
    let dose = weight * doseData.dosePerKg;
    if (dose > doseData.maxDose) dose = doseData.maxDose;
    const volume = dose / conc;

    resultDiv.style.display = 'block';
    disclaimer.style.display = 'block';
    homeBtn.style.display = 'block';

    resultDiv.innerHTML = `
      <strong>Drug:</strong> ${drug.name} (${route})<br>
      <strong>Weight:</strong> ${weight.toFixed(1)} kg<br>
      <strong>Dose per kg:</strong> ${doseData.dosePerKg} mg/kg<br>
      <strong>Concentration:</strong> ${conc} mg/mL<br>
      <strong>Total Dose:</strong> ${dose.toFixed(2)} mg<br>
      <strong>Volume to Administer:</strong> ${volume.toFixed(2)} mL
    `;
  }
</script>

</body>
</html>
