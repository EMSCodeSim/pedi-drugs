<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Pump Pressure — Split Wye (Mobile Visual)</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f1624; --ink:#eaf2ff; --muted:#9fb0c8;
    --edge:rgba(255,255,255,.10); --accent:#49a3ff;
    --truck:#d62839; --hoseCommon:#f3ce6a; --hoseA:#79cfff; --hoseB:#80ffb3;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Inter,Arial,sans-serif}
  .app{display:flex;flex-direction:column;min-height:100vh}
  header{padding:14px 16px 10px;background:linear-gradient(180deg,#0c1320 0%,#0b0f14 100%);border-bottom:1px solid var(--edge);position:sticky;top:0;z-index:3}
  h1{margin:4px 0 2px;font-size:18px}
  .sub{font-size:12px;color:var(--muted)}
  .canvas{position:relative;overflow:hidden;background:linear-gradient(180deg,#0b0f14,#0e1726)}
  svg{width:100%;height:52vh;display:block}
  .controls{padding:10px 12px;background:var(--panel);border-top:1px solid var(--edge)}
  .card{background:#0e1726;border:1px solid var(--edge);border-radius:14px;padding:12px;margin:10px 0}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
  select,input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--edge);background:#0b1320;color:var(--ink);font-size:14px}
  .eq{font-family:ui-monospace,Menlo,monospace;color:#cfe4ff;font-size:13px;line-height:1.3}
  .kpis{display:flex;flex-wrap:wrap;gap:10px}
  .kpi{background:#0b1320;border:1px solid var(--edge);border-radius:12px;padding:10px 12px}
  .kpi b{font-size:20px}
  .note{font-size:12px;color:var(--muted)}
  .small{font-size:12px}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Pump Pressure — Split Wye</h1>
    <div class="sub">Common supply ➜ Wye ➜ Branch A & B (independent nozzles)</div>
  </header>

  <!-- Visual Diagram -->
  <div class="canvas">
    <svg id="scene" viewBox="0 0 390 360" preserveAspectRatio="xMidYMid slice" aria-label="Pump diagram">
      <!-- Elevation marker -->
      <g>
        <rect x="330" y="175" width="44" height="145" fill="#192740"/>
        <text x="352" y="170" text-anchor="middle" fill="#cfe4ff" font-size="10" id="elevLabel">+0 ft</text>
      </g>

      <defs>
        <filter id="glow"><feGaussianBlur stdDeviation="1.2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
      </defs>

      <!-- Common hose -->
      <path id="commonHose" d="" stroke="var(--hoseCommon)" fill="none" stroke-linecap="round" filter="url(#glow)"/>
      <circle id="wyeDot" r="3.5" fill="#ffd27a"/>

      <!-- Branch hoses -->
      <path id="branchAHose" d="" stroke="var(--hoseA)" fill="none" stroke-linecap="round" filter="url(#glow)"/>
      <path id="branchBHose" d="" stroke="var(--hoseB)" fill="none" stroke-linecap="round" filter="url(#glow)"/>
      <circle id="nozzleADot" r="4" fill="#e0ecff"/>
      <circle id="nozzleBDot" r="4" fill="#e0ecff"/>

      <!-- Truck -->
      <g id="truck" transform="translate(18,258)">
        <rect x="0" y="24" width="160" height="42" fill="var(--truck)"/>
        <rect x="110" y="0" width="52" height="30" fill="var(--truck)"/>
        <rect x="120" y="6" width="36" height="18" fill="#3e5a76"/>
        <rect x="122" y="-2" width="32" height="4" fill="#a10"/>
        <rect x="8" y="32" width="80" height="10" fill="#e9d26e"/>
        <text x="10" y="40" font-size="8" fill="#442">ENGINE 1</text>
        <circle cx="36" cy="70" r="10" fill="#263140"/>
        <circle cx="108" cy="70" r="10" fill="#263140"/>
        <!-- pump port -->
        <circle id="pumpPort" cx="90" cy="25" r="3" fill="#ddd"/>
      </g>

      <!-- Labels -->
      <text x="208" y="40" fill="#f7e39a" font-size="10" id="commonLabel">—</text>
      <text x="278" y="65" fill="#9fd8ff" font-size="10" id="labelA">—</text>
      <text x="270" y="120" fill="#b9ffcf" font-size="10" id="labelB">—</text>
    </svg>
  </div>

  <!-- Controls -->
  <div class="controls">
    <div class="card">
      <div class="grid3">
        <div>
          <label>Elevation (ft)</label>
          <input id="elevFt" type="number" step="5" value="0" />
          <div class="small note">Applies to both branches</div>
        </div>
        <div>
          <label>Wye / Appliance Loss (psi)</label>
          <input id="wyeLoss" type="number" step="1" value="10" />
          <div class="small note">Inline at split</div>
        </div>
        <div>
          <label>Elevation factor (psi/ft)</label>
          <input id="elevPsi" type="number" step="0.001" value="0.434" />
        </div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px;font-size:14px;color:#cfe4ff">Common Supply (truck ➜ wye)</h3>
      <div class="grid2">
        <div>
          <label>Hose Size</label>
          <select id="diaCommon"></select>
        </div>
        <div>
          <label>Length (ft)</label>
          <input id="lenCommon" type="number" step="25" value="200" />
        </div>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px;font-size:14px;color:#cfe4ff">Branch A</h3>
      <div class="grid2">
        <div>
          <label>Hose Size</label>
          <select id="diaA"></select>
        </div>
        <div>
          <label>Length (ft)</label>
          <input id="lenA" type="number" step="25" value="200" />
        </div>
      </div>
      <div style="margin-top:8px">
        <label>Nozzle (sets GPM & NP)</label>
        <select id="nozA"></select>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px;font-size:14px;color:#cfe4ff">Branch B</h3>
      <div class="grid2">
        <div>
          <label>Hose Size</label>
          <select id="diaB"></select>
        </div>
        <div>
          <label>Length (ft)</label>
          <input id="lenB" type="number" step="25" value="150" />
        </div>
      </div>
      <div style="margin-top:8px">
        <label>Nozzle (sets GPM & NP)</label>
        <select id="nozB"></select>
      </div>
    </div>

    <div class="card">
      <div class="eq" id="eq">PDP = FL(common @ Qt) + Wye + max( NP+FL(A@Qa)+Elev , NP+FL(B@Qb)+Elev )</div>
      <div class="kpis" style="margin-top:8px">
        <div class="kpi"><div>Total Flow</div><b id="Qt">— gpm</b></div>
        <div class="kpi"><div>Branch A</div><b id="Qa">— gpm</b></div>
        <div class="kpi"><div>Branch B</div><b id="Qb">— gpm</b></div>
        <div class="kpi"><div>PDP</div><b id="PDP">— psi</b></div>
      </div>
      <div class="note" id="breakdown" style="margin-top:8px"></div>
    </div>
  </div>
</div>

<script>
  // ---- Presets ----
  const COEFF = {"1.5":24,"1.75":15.5,"2":8,"2.5":2,"3":0.8,"4":0.2,"5":0.08}; // FL = C*(Q/100)^2*(L/100)
  const NOZZLES = [
    {name:"None (closed)", gpm:0, NP:0},
    {name:"Fog 95", gpm:95, NP:100},
    {name:"Fog 125", gpm:125, NP:100},
    {name:"Fog 150", gpm:150, NP:100},
    {name:'SB 7/8"', gpm:160, NP:50},
    {name:'SB 15/16"', gpm:185, NP:50},
    {name:'SB 1"', gpm:210, NP:50}
  ];
  const HOSE_STROKE = {"1.5":10,"1.75":12,"2":14,"2.5":16,"3":18,"4":22,"5":26};

  // ---- State ----
  const state = {
    elevFt: 0,
    elevPsiPerFt: 0.434,
    wyeLoss: 10,
    common: {dia:"2.5", length:200},
    A: {dia:"1.75", length:200, nozzle: NOZZLES[3]}, // Fog 150
    B: {dia:"1.75", length:150, nozzle: NOZZLES[4]}  // SB 7/8"
  };

  // ---- DOM helpers ----
  function byId(id){ return document.getElementById(id); }
  function opt(el, text, value, sel){ const o=document.createElement('option'); o.textContent=text; o.value=value; if(sel) o.selected=true; el.appendChild(o); }

  // Populate selects
  (function initControls(){
    const diaOpts = Object.keys(COEFF);
    ["diaCommon","diaA","diaB"].forEach(id=>{
      const sel = byId(id); sel.innerHTML="";
      diaOpts.forEach(d=> opt(sel, `${d}″`, d, (id==="diaCommon"?state.common.dia:(id==="diaA"?state.A.dia:state.B.dia))===d));
    });
    ["nozA","nozB"].forEach(id=>{
      const sel = byId(id); sel.innerHTML="";
      NOZZLES.forEach(n=> opt(sel, n.name, n.name, (id==="nozA"?state.A.nozzle:state.B.nozzle).name===n.name));
    });

    byId("elevFt").value = state.elevFt;
    byId("elevPsi").value = state.elevPsiPerFt;
    byId("wyeLoss").value = state.wyeLoss;

    // Listeners
    byId("elevFt").oninput = e=>{ state.elevFt = parseFloat(e.target.value||0); render(); };
    byId("elevPsi").oninput = e=>{ state.elevPsiPerFt = parseFloat(e.target.value||0); render(); };
    byId("wyeLoss").oninput = e=>{ state.wyeLoss = parseFloat(e.target.value||0); render(); };

    byId("diaCommon").onchange = e=>{ state.common.dia = e.target.value; render(); };
    byId("lenCommon").oninput = e=>{ state.common.length = parseFloat(e.target.value||0); render(); };

    byId("diaA").onchange = e=>{ state.A.dia = e.target.value; render(); };
    byId("lenA").oninput = e=>{ state.A.length = parseFloat(e.target.value||0); render(); };
    byId("nozA").onchange = e=>{
      const found = NOZZLES.find(n=>n.name===e.target.value); if(found){ state.A.nozzle=found; render(); }
    };

    byId("diaB").onchange = e=>{ state.B.dia = e.target.value; render(); };
    byId("lenB").oninput = e=>{ state.B.length = parseFloat(e.target.value||0); render(); };
    byId("nozB").onchange = e=>{
      const found = NOZZLES.find(n=>n.name===e.target.value); if(found){ state.B.nozzle=found; render(); }
    };
  })();

  // ---- Math ----
  function fl(C, Q, L){ return (C||0) * Math.pow(Q/100, 2) * (L/100); } // psi
  function calc(){
    const Qa = state.A.nozzle.gpm;
    const Qb = state.B.nozzle.gpm;
    const Qt = Qa + Qb;

    const Cc = COEFF[state.common.dia];
    const Ca = COEFF[state.A.dia];
    const Cb = COEFF[state.B.dia];

    const FLc = fl(Cc, Qt, state.common.length);
    const FLa = fl(Ca, Qa, state.A.length);
    const FLb = fl(Cb, Qb, state.B.length);

    const elevPsi = state.elevFt * state.elevPsiPerFt;

    const needA = state.A.nozzle.NP + FLa + elevPsi;
    const needB = state.B.nozzle.NP + FLb + elevPsi;

    const PDP = FLc + state.wyeLoss + Math.max(needA, needB);

    return {Qa,Qb,Qt, FLc,FLa,FLb, elevPsi, needA, needB, PDP};
  }

  // ---- Diagram helpers ----
  function pathCubic(p0, c1, c2, p3){ return `M ${p0.x} ${p0.y} C ${c1.x} ${c1.y}, ${c2.x} ${c2.y}, ${p3.x} ${p3.y}`; }

  function renderDiagram(){
    const pump = {x:113, y:283}; // pumpPort area
    const wye = {x:240, y:175};
    const nozA = {x:340, y:85};
    const nozB = {x:315, y:130};

    // Common hose curve
    const c1c = {x:150, y:230}, c2c = {x:200, y:200};
    byId("commonHose").setAttribute("d", pathCubic(pump, c1c, c2c, wye));
    byId("wyeDot").setAttribute("cx", wye.x); byId("wyeDot").setAttribute("cy", wye.y);

    // Branch A curve
    const c1a = {x:270, y:130}, c2a = {x:305, y:105};
    byId("branchAHose").setAttribute("d", pathCubic(wye, c1a, c2a, nozA));
    byId("nozzleADot").setAttribute("cx", nozA.x); byId("nozzleADot").setAttribute("cy", nozA.y);

    // Branch B curve
    const c1b = {x:260, y:170}, c2b = {x:300, y:145};
    byId("branchBHose").setAttribute("d", pathCubic(wye, c1b, c2b, nozB));
    byId("nozzleBDot").setAttribute("cx", nozB.x); byId("nozzleBDot").setAttribute("cy", nozB.y);

    // Stroke widths by hose size
    byId("commonHose").setAttribute("stroke-width", HOSE_STROKE[state.common.dia] || 14);
    byId("branchAHose").setAttribute("stroke-width", HOSE_STROKE[state.A.dia] || 12);
    byId("branchBHose").setAttribute("stroke-width", HOSE_STROKE[state.B.dia] || 12);

    // Labels
    byId("commonLabel").textContent = `${state.common.dia}″ • ${state.common.length} ft`;
    byId("labelA").textContent = `A: ${state.A.dia}″ • ${state.A.length} ft • ${state.A.nozzle.name}`;
    byId("labelB").textContent = `B: ${state.B.dia}″ • ${state.B.length} ft • ${state.B.nozzle.name}`;

    // Elevation label
    byId("elevLabel").textContent = `${state.elevFt>0?'+':''}${state.elevFt} ft`;
  }

  // ---- Render everything ----
  function render(){
    renderDiagram();
    const out = calc();

    byId("Qt").textContent = `${out.Qt} gpm`;
    byId("Qa").textContent = `${out.Qa} gpm`;
    byId("Qb").textContent = `${out.Qb} gpm`;
    byId("PDP").textContent = `${Math.round(out.PDP)} psi`;

    const eq = [
      `FL(common@Qt)=${out.FLc.toFixed(0)} psi`,
      `Wye=${state.wyeLoss.toFixed(0)} psi`,
      `A: NP(${state.A.nozzle.NP})+FL(${out.FLa.toFixed(0)})+Elev(${out.elevPsi.toFixed(0)}) → ${out.needA.toFixed(0)} psi`,
      `B: NP(${state.B.nozzle.NP})+FL(${out.FLb.toFixed(0)})+Elev(${out.elevPsi.toFixed(0)}) → ${out.needB.toFixed(0)} psi`
    ].join(' • ');
    byId("breakdown").textContent = eq;
  }

  // Kick things off
  render();
</script>
</body>
</html>
