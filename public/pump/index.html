<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Visual Pump Builder — Deploy-to-Show Math</title>
<meta name="theme-color" content="#0b0b0b">
<style>
  :root{--bg:#0b0b0b;--fg:#eaeaea;--muted:#a3a3a3;--card:#151515;--accent:#3b82f6}
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  .wrap{width:min(980px,92%);margin:0 auto}
  header{padding:20px 0 6px}
  h1{margin:0;font-size:22px}
  .grid{display:grid;gap:16px;grid-template-columns:1fr; padding:12px 0 28px}
  @media (min-width:900px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border:1px solid #232323;border-radius:16px;padding:16px}
  .row{display:flex;gap:10px;align-items:center;margin:8px 0}
  label{min-width:86px;opacity:.9}
  select, input{width:100%;background:#0f0f0f;color:var(--fg);border:1px solid #232323;border-radius:12px;padding:10px}
  .switch{display:flex;align-items:center;gap:10px;margin:8px 0}
  .pill{display:inline-block;background:#0f0f0f;border:1px solid #232323;border-radius:9999px;padding:6px 10px;font-size:12px;margin-left:8px}
  .metrics{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .metric{background:#0f0f0f;border:1px solid #232323;border-radius:12px;padding:10px 12px}
  .metric b{display:block;font-size:12px;opacity:.8}
  .metric span{font-size:16px;font-weight:700}
  .title{font-weight:700;margin:0 0 10px}
  .foot{color:var(--muted);padding:16px 0 28px}
  .is-hidden{display:none!important}
</style>
</head>
<body>
  <header class="wrap">
    <h1>Visual Pump Builder <span class="pill">Math shows only when deployed</span></h1>
  </header>

  <main class="wrap grid">
    <!-- LINE A -->
    <section class="card" id="leftLine">
      <p class="title">Line A</p>

      <div class="switch">
        <input id="deployLeft" type="checkbox">
        <label for="deployLeft">Deploy Line A</label>
      </div>

      <div class="row">
        <label for="nozLeft">Nozzle</label>
        <select id="nozLeft"></select>
      </div>

      <!-- math box (hidden until deployed) -->
      <div id="leftMath" class="is-hidden">
        <div class="metrics">
          <div class="metric"><b>Type</b><span id="leftType">—</span></div>
          <div class="metric"><b>NP (psi)</b><span id="leftNP">—</span></div>
          <div class="metric"><b>Flow (gpm)</b><span id="leftGPM">—</span></div>
        </div>
      </div>
    </section>

    <!-- LINE B -->
    <section class="card" id="rightLine">
      <p class="title">Line B</p>

      <div class="switch">
        <input id="deployRight" type="checkbox">
        <label for="deployRight">Deploy Line B</label>
      </div>

      <div class="row">
        <label for="nozRight">Nozzle</label>
        <select id="nozRight"></select>
      </div>

      <!-- math box (hidden until deployed) -->
      <div id="rightMath" class="is-hidden">
        <div class="metrics">
          <div class="metric"><b>Type</b><span id="rightType">—</span></div>
          <div class="metric"><b>NP (psi)</b><span id="rightNP">—</span></div>
          <div class="metric"><b>Flow (gpm)</b><span id="rightGPM">—</span></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="wrap foot">
    <small>© <script>document.write(new Date().getFullYear())</script> FireOps SIM</small>
  </footer>

<script>
/* Nozzle catalog (Smooth Bore + Fog) */
const NOZ = {
  // Smooth-bore
  sb7_8:     {id:'sb7_8',     grp:'Smooth Bore', name:'SB 7/8″',     gpm:160, NP:50},
  sb15_16:   {id:'sb15_16',   grp:'Smooth Bore', name:'SB 15/16″',   gpm:185, NP:50},
  sb1_0:     {id:'sb1_0',     grp:'Smooth Bore', name:'SB 1″',       gpm:210, NP:50},
  sb1_1_8:   {id:'sb1_1_8',   grp:'Smooth Bore', name:'SB 1 1/8″',   gpm:265, NP:50},
  sb1_1_4:   {id:'sb1_1_4',   grp:'Smooth Bore', name:'SB 1 1/4″',   gpm:325, NP:50},

  // Fog
  fog125_75: {id:'fog125_75', grp:'Fog',         name:'Fog 125',     gpm:125, NP:75},
  fog150_75: {id:'fog150_75', grp:'Fog',         name:'Fog 150',     gpm:150, NP:75},
  fog150_100:{id:'fog150_100',grp:'Fog',         name:'Fog 150',     gpm:150, NP:100},
  fog185_75: {id:'fog185_75', grp:'Fog',         name:'Fog 185',     gpm:185, NP:75},
  fog185_100:{id:'fog185_100',grp:'Fog',         name:'Fog 185',     gpm:185, NP:100},
  fog200_75: {id:'fog200_75', grp:'Fog',         name:'Fog 200',     gpm:200, NP:75},
  fog200_100:{id:'fog200_100',grp:'Fog',         name:'Fog 200',     gpm:200, NP:100},

  // Legacy-friendly example
  chiefXD:   {id:'chiefXD',   grp:'Fog',         name:'ChiefXD 185', gpm:185, NP:50}
};
const NOZ_LIST = Object.values(NOZ);

/* State (now includes 'deployed' flags) */
const L = {
  left:  { deployed:false, noz: NOZ.sb15_16 },   // default SB 15/16 @50
  right: { deployed:false, noz: NOZ.fog150_75 }  // default Fog 150 @75
};

function renderNozzleSelect(sel, side){
  const groups = {
    'Smooth Bore': NOZ_LIST.filter(n => n.grp === 'Smooth Bore'),
    'Fog':         NOZ_LIST.filter(n => n.grp === 'Fog')
  };
  sel.innerHTML = Object.entries(groups).map(([label, items]) =>
    `<optgroup label="${label}">` +
      items.map(n => `<option value="${n.id}">${n.name} ${n.NP}/${n.gpm}</option>`).join('') +
    `</optgroup>`
  ).join('');
  sel.value = (side === 'left' ? L.left.noz.id : L.right.noz.id);
}

function updateLineMetrics(side){
  const noz = side === 'left' ? L.left.noz : L.right.noz;
  document.getElementById(side+'Type').textContent = noz.grp;
  document.getElementById(side+'NP').textContent   = noz.NP;
  document.getElementById(side+'GPM').textContent  = noz.gpm;
}

function setDeployed(side, val){
  if(side==='left'){ L.left.deployed = val; }
  else { L.right.deployed = val; }
  document.getElementById(side+'Math').classList.toggle('is-hidden', !val);
  // Fire an event for the larger app if you want to recalc PDP, etc.
  window.dispatchEvent(new CustomEvent('line:deploy', { detail:{ side, deployed:val }}));
}

function attachSelect(sel, side){
  sel.addEventListener('change', ()=>{
    const n = NOZ[ sel.value ];
    if(side === 'left') L.left.noz = n; else L.right.noz = n;
    updateLineMetrics(side);
    window.dispatchEvent(new CustomEvent('nozzle:changed', { detail: { side, nozzle: n }}));
  });
}

function boot(){
  const leftSel   = document.getElementById('nozLeft');
  const rightSel  = document.getElementById('nozRight');
  const depLeft   = document.getElementById('deployLeft');
  const depRight  = document.getElementById('deployRight');

  renderNozzleSelect(leftSel, 'left');
  renderNozzleSelect(rightSel,'right');
  attachSelect(leftSel, 'left');
  attachSelect(rightSel,'right');

  // deploy toggles
  depLeft.addEventListener('change', ()=> setDeployed('left', depLeft.checked));
  depRight.addEventListener('change',()=> setDeployed('right', depRight.checked));

  // initial metrics update (remain hidden until deployed)
  updateLineMetrics('left');
  updateLineMetrics('right');
  setDeployed('left',  L.left.deployed);
  setDeployed('right', L.right.deployed);
}
document.addEventListener('DOMContentLoaded', boot);
</script>
</body>
</html>
