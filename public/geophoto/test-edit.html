// REST helpers (auth header) â€” replace SDK calls with these
async function getIdTokenStrict() {
  const { getAuth } = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js");
  const u = getAuth().currentUser;
  if (!u) throw new Error("No user; sign-in required");
  return await u.getIdToken(true);
}

// List prefixes under scenarios/ using REST + ID token
async function restListPrefixes(prefix = "scenarios/") {
  const idToken = await getIdTokenStrict();
  const url = `https://firebasestorage.googleapis.com/v0/b/dailyquiz-d5279.firebasestorage.app/o?prefix=${encodeURIComponent(prefix)}&delimiter=/`;
  const r = await fetch(url, { headers: { Authorization: `Bearer ${idToken}` }, cache: "no-store" });
  if (!r.ok) throw new Error(`REST list failed: ${r.status}`);
  const j = await r.json();
  return (j.prefixes || []).map(p => p.replace(/^scenarios\//, "").replace(/\/$/, ""));
}

// Get a media URL for a path using REST + ID token
async function restGetMediaURL(path) {
  const idToken = await getIdTokenStrict();
  const metaURL = `https://firebasestorage.googleapis.com/v0/b/dailyquiz-d5279.firebasestorage.app/o/${encodeURIComponent(path)}`;
  const r = await fetch(metaURL, { headers: { Authorization: `Bearer ${idToken}` }, cache: "no-store" });
  if (!r.ok) throw new Error(`REST meta failed: ${r.status}`);
  const j = await r.json();
  const token = (j.downloadTokens || "").split(",")[0];
  if (!token) throw new Error("No download token on object");
  return `${metaURL}?alt=media&token=${token}`;
}
