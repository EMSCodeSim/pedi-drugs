<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Hardcoded Replicate Test</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{margin:0;background:#0f1115;color:#e5e9f0;font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .card{background:#1a1f2b;border:1px solid #293248;border-radius:12px;padding:16px;margin:12px 0}
  label{display:block;font-size:12px;color:#a7b0c0;margin:0 0 6px}
  input{width:100%;background:#111827;color:#eef3ff;border:1px solid #2c344a;padding:8px 10px;border-radius:8px}
  .btn{display:inline-flex;align-items:center;gap:6px;background:#22314e;border:1px solid #314266;color:#eaf1ff;padding:10px 14px;border-radius:10px;cursor:pointer;margin-right:8px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .imgbox{background:#0b0f18;border:1px solid #25304a;border-radius:10px;padding:10px}
  img{width:100%;height:auto;border-radius:8px}
  pre{white-space:pre-wrap;word-break:break-word;background:#0d1320;border:1px solid #263355;border-radius:8px;padding:10px;max-height:380px;overflow:auto}
  small{color:#a7b0c0}
</style>
</head>
<body>
<div class="wrap">
  <h1>Hardcoded Replicate Test</h1>

  <div class="card">
    <label>Function endpoint</label>
    <input id="ep" value="/.netlify/functions/ai-hardcoded-replicate">
    <div style="margin-top:8px">
      <button class="btn" id="ping">Ping</button>
      <button class="btn" id="run">Run (GET ?run=1)</button>
    </div>
    <div style="margin-top:12px" class="grid">
      <div>
        <label>Optional model version override</label>
        <input id="ver" placeholder="leave blank to use env REPLICATE_MODEL_VERSION">
      </div>
      <div>
        <label>Optional input key</label>
        <input id="ikey" value="image">
        <small>Some models use <code>init_image</code></small>
      </div>
    </div>
  </div>

  <div class="card grid">
    <div class="imgbox">
      <div style="font-size:12px;color:#a7b0c0;margin-bottom:6px">Source (hardcoded)</div>
      <img id="src">
    </div>
    <div class="imgbox">
      <div style="font-size:12px;color:#a7b0c0;margin-bottom:6px">Result</div>
      <img id="out">
    </div>
  </div>

  <div class="card">
    <div style="font-size:12px;color:#a7b0c0;margin-bottom:6px">Raw JSON</div>
    <pre id="json"></pre>
  </div>
</div>

<script>
(function(){
  const HARD_URL = "https://ff0c942b9653634369ec8ba5be3d0d8d0fd89992bef1d7b27e4acfc-apidata.googleusercontent.com/download/storage/v1/b/dailyquiz-d5279.firebasestorage.app/o/scenarios%2F-OZH6KD_krWW-FODi4A_%2F1756945542530.jpg?jk=AXbWWmk2QRyT2___ioAUJm7lFLOg2k3d8RF9kKlujhGpYAyXGw8sZ5PpfaPDfyENGh40vIRXWsRLOyM1pTugfBmgDDew3fvCbPpQgqVRD_I6R4yDjGQdGwJuJiOp_XRXuXcnNZuYiaVRzmiOicIk-wv1OZjydVSJgqxMm2lYhf2MsWEIJm2xy7mKfiY1WQMNeDQPr-WyPAA2sdckBxjRK10_8VN5rKAzLNJYfiyB8Qxab23nhQiXDSsdgtJ3LcrgvsSPr2bEzzNJ0RVBXPJvzPWwbTMIAKy06hjOex0rqfCOIVk7-pJiDwToJM3MlrTpDOFRC21Be0G47kFJ2wSkcX28pdjg4bJFcOhW8b6czLk2q84aNjpT1MKrlK6vKR35FaQx1tWwxBSFcF5XEwxys9OmMD4-2UnxdzS_Wtf4NQmmILZ5w30WoN0PQmgkqb_P3yANQNMeJP6Y6eSyV9aOsLK4gtrsfxKM5lUI4a23HvKxw7kIGpbAlvZfGO00qQCESi9UBohN41AK9B2qh1eddEFaDQ4EiwMNc7qG2P2gbcFzfF_iCsPUa29VA5ExV9Mnb5OLR-Pop9aC6TGCRUowvcHX5brGSbcLEucjm9x4QAoYnGE02y-jP-7icjzP1CaDe0Xp4sw9PRBlwu_UtdB-BYG1MHnCh_i9MKvaNKNTKsYFnLJGzy0m_uwi3QEBUwHrrygma_GArZ58hWuMqj4BLb-1IveK6ppVVJ2qQQ2HCupojUXSaNICF_2PFgiMTDF_i0twMcn7CbhCOtgJpmKHTDx1EiM5smexxKed9jEeje9TXpkQHgDc3vy-XsQrMOLvXXy_QEjQv2yCEW5pxSEQowrFr4k_zwBC1yFrxlgabPcVjzayzIxGtTU9oP6qw3ghGvb_6XmE2_DigShOYFRLQ0vvtC4Gq0h-YEwSJfHHEMVmDhz3NHhu4CrF1GZU78_SdscOq69J1VInLhxV6pYa3vtRM4E8FLVd010QAkp5wq01ivAHvQyEVBvENGgZ6hBxEh_lhSacOg8A2nIt2WKGwaQbu6WQhVsEMkB-GVR05839dlldSpaiL34LEYIjE4USdcjKJo8YagdT6t8KEqWc5tCp1cBgMC1bqqy6AR6PAQd0vNu4Wqb83tgTRI4NGSaI3pY9-gYCctaF09a1NILpgzVI-wmacJiaWIB6EmIYK6gnuF8T2ahbcRzBPy9-Sz7iHMsdfSSV5qCe9cl2ZQiseQnOVoWkIQ&isca=1";
  const $ = id => document.getElementById(id);
  $("src").src = HARD_URL;

  function showJSON(j){ $("json").textContent = JSON.stringify(j, null, 2); }
  function pickURL(j){
    if (j && j.image && typeof j.image.url === "string") return j.image.url;
    if (j && typeof j.image === "string") return j.image;
    if (j && typeof j.url === "string") return j.url;
    if (j && Array.isArray(j.output)) {
      const s = j.output.find(x => typeof x === "string" && /^https?:\/\//i.test(x));
      if (s) return s;
    }
    return null;
  }

  $("ping").onclick = async ()=> {
    const r = await fetch($("ep").value + "?ping=1");
    showJSON(await r.json().catch(()=>({status:r.status})));
  };

  $("run").onclick = async ()=> {
    const ep = $("ep").value.trim();
    const params = new URLSearchParams();
    params.set("run","1");
    const ver = $("ver").value.trim(); if (ver) params.set("version", ver);
    const ik = $("ikey").value.trim(); if (ik) params.set("input_key", ik);

    const url = ep + "?" + params.toString();
    const r = await fetch(url);
    const ct = (r.headers.get("content-type")||"").toLowerCase();
    const j = ct.includes("application/json") ? await r.json().catch(()=>null) : { status:r.status, text: await r.text().catch(()=>"(no text)") };
    showJSON(j);
    const out = pickURL(j);
    if (out) $("out").src = out;
  };
})();
</script>
</body>
</html>
