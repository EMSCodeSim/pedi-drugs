<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Advanced Photo Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f1115; --panel:#171923; --text:#e6e6e6; --muted:#a4a8b3; --accent:#6aa3ff; }
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; background:var(--bg); color:var(--text);
      font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
    .app { display:grid; grid-template-columns: 320px 1fr 380px; height:100%; }

    /* Left: Scenario panel */
    .left { background:var(--panel); border-right:1px solid #232634; padding:14px; overflow:auto; }
    h1,h2 { margin:0 0 10px; font-size:16px; color:#fff; }
    h2 { font-size:14px; color:#dfe7ff; margin-top:14px; }
    label { display:block; font-size:12px; color:var(--muted); margin:0 0 6px; }
    select,input[type="text"],textarea {
      width:100%; background:#131621; color:#e8e8e8; border:1px solid #272b3a;
      padding:8px 10px; border-radius:8px; outline:none;
    }
    textarea { min-height:72px; resize:vertical; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:6px;
      background:#1f2534; color:#e8f0ff; border:1px solid #2b3246; padding:8px 10px;
      border-radius:10px; cursor:pointer; margin:3px 2px; }
    .btn:hover { background:#252c40; }
    .btn[disabled] { opacity:.55; cursor:not-allowed; }
    .row { display:flex; gap:6px; margin-bottom:8px; }
    .row > * { flex:1 1 0; }

    .thumbs { display:grid; grid-template-columns: repeat(2, 1fr); gap:8px; margin-top:10px; }
    .thumb { border:1px solid #2b3246; background:#0c0f16; border-radius:8px; overflow:hidden;
      cursor:pointer; position:relative; }
    .thumb img { width:100%; height:100%; display:block; object-fit:cover; aspect-ratio: 4/3; }
    .thumb .cap { position:absolute; bottom:0; left:0; right:0; background:linear-gradient(transparent, rgba(0,0,0,.7));
      color:#dfe7ff; font-size:11px; padding:24px 6px 6px; }
    .thumb.active { outline:2px solid var(--accent); }

    /* Center: Canvas/viewer */
    .center { display:flex; align-items:center; justify-content:center; background:#0b0e14; position:relative; }
    #mainCanvas { width: min(98%, 1400px); height: auto; max-height: 96%; background:#0a0d13; border-radius:12px; border:1px solid #232634; }

    /* Right: AI panel */
    .right { background:var(--panel); border-left:1px solid #232634; padding:14px; overflow:auto; }
    .status { margin-top:8px; font-size:12px; color:#b9c3d9; min-height:1.4em; }
    .sep { height:1px; background:#262a38; margin:14px 0; }
  </style>
</head>
<body>
  <div class="app">

    <!-- SCENARIOS PANEL -->
    <aside class="left">
      <h1>Scenarios</h1>

      <div class="row">
        <select id="scenarioSelect" title="Pick a scenario"></select>
        <button class="btn" id="scenarioNew">New</button>
      </div>

      <div class="row">
        <button class="btn" id="scenarioLoadImgs">Load Images</button>
        <button class="btn" id="scenarioLoadJson">Load JSON</button>
      </div>

      <div class="row">
        <button class="btn" id="scenarioAddUrl">Add Image URL</button>
        <button class="btn" id="scenarioSave">Save JSON</button>
      </div>

      <div class="row">
        <button class="btn" id="scenarioPrev">◀ Prev</button>
        <button class="btn" id="scenarioNext">Next ▶</button>
      </div>

      <div class="row">
        <button class="btn" id="stopDelete">Delete Stop</button>
        <button class="btn" id="stopRename">Rename</button>
      </div>

      <label for="scenarioName">Scenario name</label>
      <input id="scenarioName" type="text" placeholder="Untitled scenario" />

      <h2>Slides / Photos</h2>
      <div id="thumbs" class="thumbs"></div>

      <!-- hidden file inputs -->
      <input type="file" id="fileImages" accept="image/*" multiple style="display:none" />
      <input type="file" id="fileJson" accept="application/json" style="display:none" />
    </aside>

    <!-- VIEWER -->
    <main class="center">
      <canvas id="mainCanvas" width="1600" height="900"></canvas>
    </main>

    <!-- AI PANEL -->
    <aside class="right">
      <h1>AI Controls</h1>

      <div class="row">
        <div style="flex:1">
          <label for="aiReturn">Return</label>
          <select id="aiReturn">
            <option value="photo" selected>Photo</option>
            <option value="overlays">Overlays (transparent)</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="aiStyle">Style</label>
          <select id="aiStyle">
            <option value="realistic" selected>Realistic</option>
            <option value="cinematic">Cinematic</option>
            <option value="vivid">Vivid</option>
            <option value="illustrative">Illustrative</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div style="flex:1">
          <label for="aiStrength">Strength</label>
          <input id="aiStrength" type="text" value="0.35" />
        </div>
      </div>

      <label for="aiNotes">Prompt / Notes</label>
      <textarea id="aiNotes" placeholder="Describe changes you'd like…"></textarea>

      <div class="row">
        <button class="btn" id="aiPreview" type="button">Preview</button>
        <button class="btn" id="aiSend" type="button">Send to AI</button>
      </div>
      <div class="row">
        <button class="btn" id="aiOpen" type="button" disabled>Open Result</button>
        <button class="btn" id="aiAdd" type="button" disabled>Add as New Stop</button>
      </div>

      <div id="aiMsg" class="status">AI ready</div>

      <div class="sep"></div>

      <label>Endpoint (optional override)</label>
      <input id="aiEndpoint" type="text" placeholder="/.netlify/functions/ai-image" />
      <div class="row">
        <button class="btn" type="button" onclick="
          (function(){
            var v=document.getElementById('aiEndpoint').value.trim();
            if(!v){ delete window.__AI_ENDPOINTS__; document.getElementById('aiMsg').textContent='Cleared custom endpoint'; return; }
            window.__AI_ENDPOINTS__=[v];
            document.getElementById('aiMsg').textContent='Using custom endpoint: '+v;
          })();
        ">Use Endpoint</button>
        <button class="btn" type="button" onclick="delete window.__AI_ENDPOINTS__; document.getElementById('aiMsg').textContent='Using default endpoints';">Reset</button>
      </div>
    </aside>

  </div>

  <!-- SCRIPTS (legacy, no modules) -->
  <script defer src="./scenarios-ui.legacy.js"></script>
  <script defer src="./ai-upload.legacy.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      if (window.wireScenarioUI) window.wireScenarioUI();
      if (window.wireAI) window.wireAI();
    });
  </script>
</body>
</html>
