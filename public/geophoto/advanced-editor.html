<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Advanced Photo Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root { --bg:#0f1115; --panel:#171923; --text:#e6e6e6; --muted:#a4a8b3; --accent:#6aa3ff; }
    html,body { height:100%; margin:0; background:var(--bg); color:var(--text); font:14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .app { display:flex; height:100%; }
    .left { flex: 1 1 auto; display:flex; align-items:center; justify-content:center; background:#0c0e13; }
    .right { width:360px; background:var(--panel); border-left:1px solid #232634; padding:16px; overflow:auto; }
    h1 { font-size:16px; margin:0 0 12px; color:#fff; }
    .grp { margin-bottom:16px; }
    label { display:block; font-size:12px; color:var(--muted); margin:0 0 6px; }
    input[type="text"], textarea, select {
      width:100%; box-sizing:border-box; background:#131621; color:#e8e8e8;
      border:1px solid #272b3a; padding:8px 10px; border-radius:8px; outline:none;
    }
    textarea { min-height:86px; resize:vertical; }
    .row { display:flex; gap:8px; }
    .row > * { flex:1 1 0; }
    .btnbar { display:flex; gap:8px; margin-top:8px; }
    button {
      background:#1f2534; color:#e8f0ff; border:1px solid #2b3246; padding:9px 12px;
      border-radius:10px; cursor:pointer; transition:transform .05s ease, background .15s ease;
    }
    button:hover { background:#252c40; }
    button:active { transform: translateY(1px); }
    button[disabled] { opacity:.5; cursor:not-allowed; }
    .status { margin-top:8px; font-size:12px; color:#b9c3d9; min-height:1.4em; }
    .sep { height:1px; background:#262a38; margin:16px 0; }
    .thumbWrap { width:92%; max-width:960px; aspect-ratio:16/9; background:#0a0d13; border:1px dashed #283048; border-radius:12px; display:flex; align-items:center; justify-content:center; color:#3e465e; }
  </style>
</head>
<body>
  <div class="app">
    <main class="left">
      <!-- Your canvas/viewer goes here. The scenarios module should handle rendering. -->
      <div class="thumbWrap">
        <div>Viewer / Canvas area</div>
      </div>
    </main>

    <aside class="right">
      <h1>AI Controls</h1>

      <div class="grp">
        <label for="aiReturn">Return</label>
        <select id="aiReturn">
          <option value="photo" selected>Photo</option>
          <option value="overlays">Overlays (transparent)</option>
        </select>
      </div>

      <div class="grp row">
        <div>
          <label for="aiStyle">Style</label>
          <select id="aiStyle">
            <option value="realistic" selected>Realistic</option>
            <option value="cinematic">Cinematic</option>
            <option value="vivid">Vivid</option>
            <option value="illustrative">Illustrative</option>
          </select>
        </div>
        <div>
          <label for="aiStrength">Strength</label>
          <input id="aiStrength" type="text" value="0.35" />
        </div>
      </div>

      <div class="grp">
        <label for="aiNotes">Prompt / Notes</label>
        <textarea id="aiNotes" placeholder="Describe changes you'd likeâ€¦"></textarea>
      </div>

      <div class="btnbar">
        <button id="aiPreview" type="button">Preview</button>
        <button id="aiSend" type="button">Send to AI</button>
      </div>
      <div class="btnbar">
        <button id="aiOpen" type="button" disabled>Open Result</button>
        <button id="aiAdd" type="button" disabled>Add as New Stop</button>
      </div>

      <div id="aiMsg" class="status">AI ready</div>

      <div class="sep"></div>

      <div class="grp">
        <label>Endpoint (optional override)</label>
        <input id="aiEndpoint" type="text" placeholder="/.netlify/functions/ai-image" />
        <div class="btnbar">
          <button type="button" onclick="
            (function(){
              var v=document.getElementById('aiEndpoint').value.trim();
              if(!v){ delete window.__AI_ENDPOINTS__; document.getElementById('aiMsg').textContent='Cleared custom endpoint'; return; }
              window.__AI_ENDPOINTS__=[v];
              document.getElementById('aiMsg').textContent='Using custom endpoint: '+v;
            })();
          ">Use Endpoint</button>
          <button type="button" onclick="delete window.__AI_ENDPOINTS__; document.getElementById('aiMsg').textContent='Using default endpoints';">Reset</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- ====================== SCRIPT LOADING (legacy, no modules) ====================== -->

  <!-- (A) Try to load your scenarios file. If your file is named 'scenarios.js', change the src below accordingly.
         This loader tries 'scenarios (1).js' first, then falls back to 'scenarios.js'. -->
  <script>
    (function(){
      function loadScript(src, onload, onerror){
        var s = document.createElement('script');
        s.src = src; s.defer = true; s.onload = onload; s.onerror = onerror || function(){};
        document.head.appendChild(s);
      }
      function tryLoadList(list, done){
        (function next(i){
          if (i>=list.length) return done(false);
          loadScript(list[i], function(){ done(true, list[i]); }, function(){ next(i+1); });
        })(0);
      }
      // URL-encoded name handles the space + parentheses
      var candidates = [
        "./scenarios%20(1).js",
        "./scenarios.js"
      ];
      tryLoadList(candidates, function(ok, used){
        if (!ok) {
          console.warn("[html] Failed to load scenarios module from", candidates);
        } else {
          console.log("[html] Scenarios loaded:", used);
        }
      });
    })();
  </script>

  <!-- (B) Load the legacy AI client (no modules). It exposes window.wireAI and auto-inits. -->
  <script defer src="./ai-upload.legacy.js"></script>

  <!-- (C) (Optional) Kick the wiring once DOM is ready (legacy file also auto-wires). -->
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      if (window.wireAI) window.wireAI();
    });
  </script>
</body>
</html>
